<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>Compatibilidad del controlador JDBC con alta disponibilidad y recuperación ante desastres</title><meta name="Language" content="es-es" /><meta name="Microsoft.Help.Id" content="62de4be6-b027-427d-a7e5-352960e42877" /><meta name="Description" content="En este tema se describe la compatibilidad de Controlador Microsoft JDBC para SQL Server para la alta disponibilidad y la recuperación ante desastres: Grupos de disponibilidad AlwaysOn." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">Compatibilidad del controlador JDBC con alta disponibilidad y recuperación ante desastres</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>En este tema se describe la compatibilidad de Controlador Microsoft JDBC para SQL Server para la alta disponibilidad y la recuperación ante desastres: Grupos de disponibilidad AlwaysOn. Para obtener más información sobre Grupos de disponibilidad AlwaysOn, vea los Libros en pantalla de SQL Server 2012.</p><p>A partir de la versión 4.0 de Controlador Microsoft JDBC para SQL Server, puede especificar el agente de escucha de un grupo de disponibilidad (alta disponibilidad, recuperación ante desastres) en la propiedad de conexión. Si una aplicación Controlador Microsoft JDBC para SQL Server está conectada a una base de datos AlwaysOn que conmuta por error, se interrumpirá la conexión original y la aplicación deberá abrir una conexión nueva para seguir trabajando después de la conmutación por error.</p><p>Si no está conectado a un agente de escucha de grupo de disponibilidad y hay varias direcciones IP asociadas a un servidor, el Controlador Microsoft JDBC para SQL Server intentará conectarse a la primera dirección IP. Si el Controlador Microsoft JDBC para SQL Server no puede establecer una conexión con la primera dirección IP, se producirá un error en la conexión. El Controlador Microsoft JDBC para SQL Server no intentará conectarse a ninguna dirección IP más asociada al servidor. Cuando se conecta a un agente de escucha de grupo de disponibilidad, el Controlador Microsoft JDBC para SQL Server intenta establecer conexiones con todas las direcciones IP en paralelo y, si un intento de conexión se realiza correctamente, el controlador descartará los demás intentos de conexión pendientes.</p><div style="margin: .5em 1.5em .5em 1.5em"><b></b><p>Si se aumenta el tiempo de espera de conexión y se implementar lógica de reintento de conexión, aumentará la probabilidad de que una aplicación se conecte a un grupo de disponibilidad. Además, como se puede producir un error en una conexión debido a la conmutación por error de un grupo de disponibilidad, se debe implementar lógica de reintento de conexión para reintentar una conexión errónea hasta que vuelva a conectarse.</p></div><p>Se han agregado al Controlador Microsoft JDBC 4.0 para SQL Server las siguientes <a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">propiedades de conexión</a>:</p><ul><li><p><span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span></p></li><li><p><span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span></p></li></ul></div><h1 class="heading">Conectar con MultiSubnetFailover</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>Especifique siempre <span sdata="langKeyword" value="multiSubnetFailover=true"><span class="keyword">multiSubnetFailover=true</span></span> cuando se conecte al agente de escucha de un grupo de disponibilidad de SQL Server 2012 o una instancia de clúster de conmutación por error de SQL Server 2012. <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> permite una conmutación por error más rápida para todos los grupos de disponibilidad y todas las instancias de clúster de conmutación por error en SQL Server 2012, y reducirá considerablemente el tiempo de conmutación por error en las topologías AlwaysOn de una y de múltiples subredes. Durante una conmutación por error de múltiples subredes, el cliente intentará establecer conexiones en paralelo. Durante una conmutación por error de subred, el Controlador Microsoft JDBC para SQL Server reintentará agresivamente la conexión TCP.</p><p>La propiedad de conexión <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> indica que la aplicación se está implementando en un grupo de disponibilidad o en una instancia de clúster de conmutación por error y que el Controlador Microsoft JDBC para SQL Server intentará conectar con la base de datos en la instancia principal de SQL Server intentando conectarse a todas las direcciones IP. Cuando se especifica <span sdata="langKeyword" value="MultiSubnetFailover=true"><span class="keyword">MultiSubnetFailover=true</span></span> para una conexión, el cliente reintenta la conexión TCP más deprisa que los intervalos de retransmisión TCP predeterminados del sistema operativo. Esto permite una reconexión más rápida después de la conmutación por error de un grupo de disponibilidad o una instancia de clúster de conmutación por error AlwaysOn, tanto de una como de múltiples subredes.</p><p>Para obtener más información acerca de las palabras clave de la cadena de conexión en el Controlador Microsoft JDBC para SQL Server, vea <span sdata="link"><a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">Establecer las propiedades de conexión</a></span>.</p><p>La especificación de <span sdata="langKeyword" value="multiSubnetFailover=true"><span class="keyword">multiSubnetFailover=true</span></span> al conectar con algo distinto de un agente de escucha de grupo de disponibilidad o una instancia de clúster de conmutación por error puede afectar negativamente al rendimiento y no se admite.</p><p>Si el administrador de seguridad no está instalado, la máquina virtual Java almacenará en memoria caché las direcciones IP virtuales (VIP) durante un período finito de tiempo, definido de manera predeterminada por la implementación de JDK y por las propiedades networkaddress.cache.ttl y networkaddress.cache.negative.ttl de Java. Si el administrador de seguridad de JDK está instalado, la máquina virtual Java almacenará en memoria caché las VIP y no actualizará la caché de forma predeterminada. Debe establecer el valor de "período de vida" (networkaddress.cache.ttl) en un día para la memoria caché de la máquina virtual Java. Si no cambia el valor predeterminado a un día (aproximadamente), el valor anterior no se purgará de la memoria caché de la máquina virtual Java cuando se agregue o se actualice una VIP. Para obtener más información sobre networkaddress.cache.ttl y networkaddress.cache.negative.ttl, vea <a href="http://download.oracle.com/javase/6/docs/technotes/guides/net/properties.html">http://download.oracle.com/javase/6/docs/technotes/guides/net/properties.html</a>.</p><p>Use las directrices siguientes para conectarse a un servidor de un grupo de disponibilidad o una instancia de clúster de conmutación por error:</p><ul><li><p>El controlador generará un error si la propiedad de conexión <span sdata="langKeyword" value="instanceName"><span class="keyword">instanceName</span></span> se usa en la misma cadena de conexión que la propiedad de conexión <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span>. Esto refleja el hecho de que SQL Browser no se usa en un grupo de disponibilidad. Sin embargo, si también se especifica la propiedad de conexión <span sdata="langKeyword" value="portNumber"><span class="keyword">portNumber</span></span>, el controlador omitirá <span sdata="langKeyword" value="instanceName"><span class="keyword">instanceName</span></span> y usará <span sdata="langKeyword" value="portNumber"><span class="keyword">portNumber</span></span>.</p></li><li><p>Use la propiedad de conexión <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> cuando se conecte a una única subred o a varias subredes, ya que mejorará el rendimiento en ambos casos.</p></li><li><p>Para conectarse a un grupo de disponibilidad, especifique el agente de escucha del grupo de disponibilidad como el servidor en la cadena de conexión. Por ejemplo, jdbc:sqlserver://VNN1.</p></li><li><p>La conexión con una instancia de SQL Server configurada con más de 64 direcciones IP producirá un error de conexión.</p></li><li><p>El comportamiento de una aplicación que usa la propiedad de conexión <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> no se ve afectado por el tipo de autenticación: autenticación de SQL Server, autenticación Kerberos o autenticación de Windows.</p></li><li><p>Incremente el valor de <span sdata="langKeyword" value="loginTimeout"><span class="keyword">loginTimeout</span></span> para dar tiempo a la conmutación por error y reducir los reintentos de conexión de la aplicación.</p></li><li><p>No se admiten transacciones distribuidas.</p></li></ul><p>Si el enrutamiento de solo lectura no está vigente, se producirá un error al conectarse a una ubicación de réplica secundaria en un grupo de disponibilidad en las situaciones siguientes:</p><ol><li><p>Si la ubicación de réplica secundaria no está configurada para aceptar conexiones.</p></li><li><p>Si una aplicación usa <span sdata="langKeyword" value="applicationIntent=ReadWrite"><span class="keyword">applicationIntent=ReadWrite</span></span> (se describe más adelante) y la ubicación de réplica secundaria está configurada para acceso de solo lectura.</p></li></ol><p>Se producirá un error en la conexión si una réplica principal está configurada para rechazar cargas de trabajo de solo lectura y la cadena de conexión contiene <span sdata="langKeyword" value="ApplicationIntent=ReadOnly"><span class="keyword">ApplicationIntent=ReadOnly</span></span>.</p></div><h1 class="heading">Actualizar para usar clústeres de múltiples subredes desde la creación de reflejo de la base de datos</h1><div id="sectionSection1" class="section" name="collapseableSection" style=""><p>Si actualiza a un escenario de múltiples subredes una aplicación del Controlador Microsoft JDBC para SQL Server que emplea actualmente creación de reflejo de la base de datos, debe quitar la propiedad de conexión <span sdata="langKeyword" value="failoverPartner"><span class="keyword">failoverPartner</span></span> y reemplazarla con <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> establecida en <span sdata="langKeyword" value="true"><span class="keyword">true</span></span>, y reemplazar el nombre del servidor en la cadena de conexión con un agente de escucha de grupo de disponibilidad. Si una cadena de conexión emplea <span sdata="langKeyword" value="failoverPartner"><span class="keyword">failoverPartner</span></span> y <span sdata="langKeyword" value="multiSubnetFailover=true"><span class="keyword">multiSubnetFailover=true</span></span>, el controlador generará un error. Sin embargo, si una cadena de conexión usa <span sdata="langKeyword" value="failoverPartner"><span class="keyword">failoverPartner</span></span> y <span sdata="langKeyword" value="multiSubnetFailover=false"><span class="keyword">multiSubnetFailover=false</span></span> (o <span sdata="langKeyword" value="ApplicationIntent=ReadWrite"><span class="keyword">ApplicationIntent=ReadWrite</span></span>), la aplicación usará la creación de reflejo de la base de datos.</p><p>El controlador devolverá un error si la creación de reflejo de la base de datos se usa en la base de datos principal del grupo de disponibilidad y si se usa <span sdata="langKeyword" value="multiSubnetFailover=true"><span class="keyword">multiSubnetFailover=true</span></span> en la cadena de conexión para conectarse a una base de datos principal en lugar de a un agente de escucha de grupo de disponibilidad.</p></div><h1 class="heading">Especificar la intención de la aplicación</h1><div id="sectionSection2" class="section" name="collapseableSection" style=""><p>Cuando <span sdata="langKeyword" value="applicationIntent=ReadOnly"><span class="keyword">applicationIntent=ReadOnly</span></span>, el cliente solicita una carga de trabajo de solo lectura al conectarse a una base de datos habilitada para AlwaysOn. El servidor exigirá la intención en el momento de la conexión y durante una instrucción USE DATABASE, pero solo para una base de datos habilitada para AlwaysOn.</p><p>La palabra clave <span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span> no funciona con bases de datos heredadas de solo lectura.</p><p>Una base de datos puede permitir o impedir cargas de trabajo de lectura en la base de datos AlwaysOn de destino. (Para ello se emplea la cláusula <span sdata="langKeyword" value="ALLOW_CONNECTIONS"><span class="keyword">ALLOW_CONNECTIONS</span></span> de las instrucciones <span sdata="langKeyword" value="PRIMARY_ROLE"><span class="keyword">PRIMARY_ROLE</span></span> y <span sdata="langKeyword" value="SECONDARY_ROLE"><span class="keyword">SECONDARY_ROLE</span></span> de Transact-SQL.)</p><p>La palabra clave <span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span> se usa para habilitar el enrutamiento de solo lectura.</p></div><h1 class="heading">Enrutamiento de solo lectura</h1><div id="sectionSection3" class="section" name="collapseableSection" style=""><p>El enrutamiento de solo lectura es una característica que puede asegurar la disponibilidad de una réplica de solo lectura de una base de datos. Para habilitar el enrutamiento de solo lectura:</p><ol><li><p>Debe conectarse a un agente de escucha de grupo de disponibilidad AlwaysOn.</p></li><li><p>La palabra clave <span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span> de la cadena de conexión se debe establecer en <span sdata="langKeyword" value="ReadOnly"><span class="keyword">ReadOnly</span></span>.</p></li><li><p> El administrador de base de datos debe configurar el grupo de disponibilidad para que permita el enrutamiento de solo lectura.</p></li></ol><p>Es posible que varias conexiones que usan enrutamiento de solo lectura no se conecten todas a la misma réplica de solo lectura. Los cambios en la sincronización de la base de datos o en la configuración de enrutamiento del servidor pueden hacer que los clientes se conecten a distintas réplicas de solo lectura. Para asegurarse de que todas las solicitudes de solo lectura se conectan a la misma réplica de solo lectura, no pase un agente de escucha de grupo de disponibilidad o una dirección IP virtual a la palabra clave <span sdata="langKeyword" value="serverName"><span class="keyword">serverName</span></span> de la cadena de conexión. En su lugar, especifique el nombre de la instancia de solo lectura.</p><p>El enrutamiento de solo lectura puede tardar más tiempo que la conexión a la réplica principal, ya que primero se conecta a la réplica principal y después busca la mejor réplica secundaria legible disponible. Este es el motivo por el que debe aumentar el tiempo de espera de inicio de sesión.</p></div><h1 class="heading">Nuevos métodos que admiten multiSubnetFailover y applicationIntent</h1><div id="sectionSection4" class="section" name="collapseableSection" style=""><p>Los métodos siguientes ofrecen acceso mediante programación a las palabras clave <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> y <span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span> de la cadena de conexión:</p><ul><li><p><a href="19411e6c-c456-4533-8252-54569a2a6b1f.htm">SQLServerDataSource.getApplicationIntent</a></p></li><li><p><a href="e164c8ac-a0ae-4638-affb-ed454e7c0708.htm">SQLServerDataSource.setApplicationIntent</a></p></li><li><p><a href="1e8cb175-5f4c-4208-b4f5-3646990a30e3.htm">SQLServerDataSource.getMultiSubnetFailover</a></p></li><li><p><a href="7ffd282d-c2f6-4d1b-a7a6-859d18b388aa.htm">SQLServerDataSource.setMultiSubnetFailover</a></p></li><li><p><a href="b5eaad8a-31ef-44ac-af11-d5caa13ac3e2.htm">SQLServerDriver.getPropertyInfo</a></p></li></ul><p>Los métodos <span sdata="langKeyword" value="getMultiSubnetFailover"><span class="keyword">getMultiSubnetFailover</span></span>, <span sdata="langKeyword" value="setMultiSubnetFailover"><span class="keyword">setMultiSubnetFailover</span></span>, <span sdata="langKeyword" value="getApplicationIntent"><span class="keyword">getApplicationIntent</span></span> y <span sdata="langKeyword" value="setApplicationIntent"><span class="keyword">setApplicationIntent</span></span> también se han agregado a <span sdata="link"><a href="097434fd-2b74-411c-a5ed-eba04481dde5.htm">Clase SQLServerDataSource</a></span>, <span sdata="link"><a href="b00e5a90-2af7-4d04-8ef8-256183777dcf.htm">Clase SQLServerConnectionPoolDataSource</a></span> y <span sdata="link"><a href="95fc7b07-2498-4a7e-8f7f-ee0d86b598b4.htm">Clase SQLServerXADataSource</a></span>.</p></div><h1 class="heading">Validación de certificados SSL</h1><div id="sectionSection5" class="section" name="collapseableSection" style=""><p>Un grupo de disponibilidad consta de varios servidores físicos. Controlador Microsoft JDBC 4.0 para SQL Server agregó compatibilidad con <span sdata="langKeyword" value="Subject Alternate Name"><span class="keyword">Subject Alternate Name</span></span> en los certificados SSL, por lo que es posible asociar varios hosts al mismo certificado. Para obtener más información sobre SSL, vea <span sdata="link"><a href="073f3b9e-8edd-4815-88ea-de0655d0325e.htm">Descripción de la compatibilidad con SSL</a></span>.</p></div><span id="seeAlsoSpan"><h1 class="heading">Vea también</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">Establecer las propiedades de conexión</a></span></div><div class="seeAlsoStyle"><span sdata="link"><a href="94bcfbe3-f00e-4774-bda8-bb7577518fec.htm">Conectar SQL Server con el controlador JDBC</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">Enviar <a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','8.0.12060.10000','%0\dLe%20agradecemos%20sus%20comentarios.%20Los%20equipos%20de%20desarrolladores%20usan%20estos%20comentarios%20para%20mejorar%20la%20documentación.%20Mientras%20revisamos%20los%20comentarios,%20es%20posible%20que%20le%20enviemos%20un%20correo%20electrónico%20para%20solicitarle%20alguna%20aclaración%20o%20comentarios%20sobre%20una%20posible%20solución.%20No%20usamos%20su%20dirección%20de%20correo%20electrónico%20para%20ningún%20otro%20propósito%20y%20ésta%20se%20borra%20una%20vez%20finalizada%20la%20revisió.%0\APara%20obtener%20más%20información%20acerca%20de%20las%20directivas%20de%20privacidad%20de%20Microsoft,%20vea%20http://privacy.microsoft.com/es-es/default.aspx.%0\A%0\d','Comentarios%20del cliente');">comentarios de </a> acerca de este tema Microsoft.</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft. Todos los derechos reservados.</a></p></span></div></div></body></html>