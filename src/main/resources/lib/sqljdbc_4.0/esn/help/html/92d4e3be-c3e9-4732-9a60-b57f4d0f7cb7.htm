<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>Usar el almacenamiento en búfer adaptable</title><meta name="Language" content="es-es" /><meta name="System.Keywords" content="adaptive" /><meta name="System.Keywords" content="almacenamiento en búfer adaptable" /><meta name="System.Keywords" content="isWrapperFor" /><meta name="System.Keywords" content="selectMethod" /><meta name="System.Keywords" content="unwrap" /><meta name="Microsoft.Help.Id" content="92d4e3be-c3e9-4732-9a60-b57f4d0f7cb7" /><meta name="Description" content="El almacenamiento en búfer adaptable está diseñado para recuperar cualquier tipo de datos de valores grandes sin sufrir la sobrecarga de los cursores de servidor." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">Usar el almacenamiento en búfer adaptable</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>El almacenamiento en búfer adaptable está diseñado para recuperar cualquier tipo de datos de valores grandes sin sufrir la sobrecarga de los cursores de servidor. La aplicaciones pueden usar la característica de almacenamiento en búfer adaptable con todas las versiones de SQL Server que son compatibles con el controlador.</p><p>Normalmente, cuando el Controlador Microsoft JDBC para SQL Server ejecuta una consulta, lleva todos los resultados del servidor a la memoria de la aplicación. Aunque este enfoque reduce el uso de recursos en SQL Server, puede iniciar una <b>OutOfMemoryError</b> en la aplicación JDBC para las consultas que producen resultados muy grandes.</p><p>Para permitir que las aplicaciones administren resultados muy grandes, el Controlador Microsoft JDBC para SQL Server proporciona almacenamiento en búfer adaptable. Con el almacenamiento en búfer adaptable, el controlador JDBC recupera los resultados de la ejecución de una instrucción de SQL Server a medida que la aplicación los necesita, en lugar de todos a la vez. El controlador también descarta los resultados en cuanto la aplicación ya no puede tener acceso a ellos. Se incluyen a continuación algunos ejemplos en los que el almacenamiento en búfer adaptable puede ser útil: </p><ul><li><p><b>La consulta genera un conjunto de resultados muy grande:</b> la aplicación puede ejecutar una instrucción SELECT que genera más filas de las que la aplicación puede almacenar en memoria. En las versiones anteriores, la aplicación tenía que utilizar un cursor de servidor para evitar un <b>OutOfMemoryError</b>. El almacenamiento en búfer adaptable permite hacer un paso de solo lectura y solo avance de un conjunto de resultados arbitrariamente grande sin requerir un cursor de servidor. </p></li><li><p><b>La consulta genera columnas de </b><a href="eaffcff1-286c-459f-83da-3150778480c9.htm">SQLServerResultSet</a><b> muy grandes o valores de parámetros OUT de </b><a href="30710a63-c05d-47d9-9cf9-c087a1c76373.htm">SQLServerCallableStatement</a><b>:</b> la aplicación puede recuperar un valor único (columna o parámetro OUT) que es demasiado grande para caber completamente en la memoria de la aplicación. El almacenamiento en búfer adaptable permite a la aplicación cliente recuperar este valor como un flujo, utilizando los métodos <b>getAsciiStream</b>, <b>getBinaryStream,</b> o <b>getCharacterStream</b>. La aplicación recupera el valor de SQL Server cuando lee del flujo.</p><p /></li></ul><div style="margin: .5em 1.5em .5em 1.5em"><b></b><p>Con el almacenamiento en búfer adaptable, el controlador JDBC solamente almacena en búfer las cantidad de datos que debe almacenar. El controlador no proporciona un método público para controlar o limitar el tamaño del búfer.</p></div></div><h1 class="heading">Establecer el almacenamiento en búfer adaptable</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>Desde la versión 2.0 del controlador JDBC, el comportamiento predeterminado del controlador es "<span sdata="langKeyword" value="adaptive"><span class="keyword">adaptive</span></span>". Dicho de otro modo, para obtener el comportamiento de almacenamiento en búfer adaptable, su aplicación no tiene que solicitar explícitamente el comportamiento adaptable. En la versión 1.2, sin embargo, el modo del almacenamiento en búfer era "<span sdata="langKeyword" value="full"><span class="keyword">full</span></span>" de manera predeterminada y la aplicación tenía que solicitar el modo de almacenamiento en búfer adaptable explícitamente.</p><p>Hay tres formas en las que una aplicación puede solicitar que la ejecución de una instrucción deba usar el almacenamiento en búfer adaptable:</p><ul><li><p>La aplicación puede establecer la propiedad de conexión <span sdata="langKeyword" value="responseBuffering"><span class="keyword">responseBuffering</span></span> en "adaptative". Para obtener más información acerca de cómo configurar las propiedades de la conexión, vea  <span sdata="link"><a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">Establecer las propiedades de conexión</a></span>. </p></li><li><p>La aplicación puede utilizar el método <a href="c9e43ff2-8117-4dca-982d-83c863d0c8e1.htm">setResponseBuffering</a> del objeto <a href="097434fd-2b74-411c-a5ed-eba04481dde5.htm">SQLServerDataSource</a> para establecer el modo de almacenamiento en búfer de respuesta para todas las conexiones creadas a través de ese objeto <a href="097434fd-2b74-411c-a5ed-eba04481dde5.htm">SQLServerDataSource</a>.</p></li><li><p>La aplicación puede utilizar el método <a href="9f489835-6cda-4c8c-b139-079639a169cf.htm">setResponseBuffering</a> de la clase <a href="ec24963c-8b51-4838-91e9-1fbfa2347451.htm">SQLServerStatement</a> para establecer el modo de almacenamiento en búfer de respuestas para un objeto de una instrucción determinada. </p></li></ul><p>Al usar la versión 1.2 del controlador JDBC, la aplicación debe convertir el objeto de la instrucción en una clase <a href="ec24963c-8b51-4838-91e9-1fbfa2347451.htm">SQLServerStatement</a> para utilizar el método <a href="9f489835-6cda-4c8c-b139-079639a169cf.htm">setResponseBuffering</a>. Los ejemplos de código de <span sdata="link"><a href="6c986144-3854-4352-8331-e79eccbefc28.htm">Leer un ejemplo de datos grandes</a></span> y de <span sdata="link"><a href="58c76635-a117-4661-8781-d6cb231c5809.htm">Leer datos grandes con un ejemplo de procedimientos almacenados</a></span> muestran el uso antiguo. </p><p>Sin embargo, con la versión 2.0 del controlador JDBC, las aplicaciones pueden usar el método <a href="53f3291f-d43a-476b-a656-d86168dacf6c.htm">isWrapperFor</a> y el método <a href="ce680176-ef04-4e44-bb6c-ec50bd06e7e6.htm">unwrap</a> para obtener acceso a la funcionalidad específica del proveedor sin ninguna suposición sobre la jerarquía de clases de la implementación. Como código muestra, vea el tema <span sdata="link"><a href="76ecc05f-a77d-40a2-bab9-91a7fcf17347.htm">Actualizar un ejemplo de datos grandes</a></span>.</p></div><h1 class="heading">Recuperar datos grandes con el almacenamiento en búfer adaptable</h1><div id="sectionSection1" class="section" name="collapseableSection" style=""><p>Cuando se leen valores grandes una vez con los métodos get&lt;Type&gt;Stream y se tiene acceso a las columnas ResultSet y a los parámetros OUT CallableStatement en el orden que devuelve SQL Server, el almacenamiento en búfer adaptable reduce la utilización de memoria de la aplicación al procesar los resultados. Al utilizar el almacenamiento en búfer adaptable:</p><ul><li><p>Los métodos <b>get&lt;Type&gt;Stream</b> definidos en las clases <a href="eaffcff1-286c-459f-83da-3150778480c9.htm">SQLServerResultSet</a> y <a href="30710a63-c05d-47d9-9cf9-c087a1c76373.htm">SQLServerCallableStatement</a> devuelven secuencias de una sola lectura de forma predeterminada, aunque se pueden restablecer las secuencias si lo determina la aplicación. Si la aplicación desea <span class="code">reset</span> el flujo, tiene que llamar primero al método <span class="code">mark</span> en ese flujo. </p></li><li><p>Los métodos <b>get&lt;Type&gt;Stream</b> definidos en las clases <a href="24170524-e1ab-4e80-8fd1-6688efacfbde.htm">SQLServerClob</a> y <a href="88bd8623-889d-4b5d-99ff-c85b32f3ff5c.htm">SQLServerBlob</a> devuelven secuencias cuya posición siempre se puede cambiar a la inicial del flujo sin llamar al método <span class="code">mark</span>. </p></li></ul><p>Cuando la aplicación utiliza el almacenamiento en búfer adaptable, los valores recuperados por los métodos <b>get&lt;Type&gt;Stream</b> solo se pueden recuperar una vez.  Si intenta llamar a cualquier método <b>get&lt;Type&gt;</b> en la misma columna o parámetro después de llamar al método <b>get&lt;Type&gt;Stream</b> del mismo objeto, se produce una excepción con un mensaje similar a "Se obtuvo acceso a los datos y estos no están disponibles para esta columna o parámetro".</p></div><h1 class="heading">Directrices para el uso del almacenamiento en búfer adaptable</h1><div id="sectionSection2" class="section" name="collapseableSection" style=""><p>Los desarrolladores de software deberían seguir estas importantes directrices para disminuir la utilización de memoria por parte de la aplicación:</p><ul><li><p>Evite utilizar la propiedad de cadena de conexión <span sdata="langKeyword" value="selectMethod=cursor"><span class="keyword">selectMethod=cursor</span></span> para permitir a la aplicación procesar un conjunto de resultados muy grande. La característica de almacenamiento en búfer adaptable permite a las aplicaciones procesar los conjuntos de resultados de solo avance y solo lectura muy grandes sin utilizar un cursor de servidor. Tenga en cuenta que cuando configura <span sdata="langKeyword" value="selectMethod=cursor"><span class="keyword">selectMethod=cursor</span></span>, se ven impactados todos los conjuntos de resultados de solo avance y solo lectura producidos por esa conexión. Dicho de otro modo, si su aplicación procesa rutinariamente conjuntos de resultados cortos con pocas filas, crear, leer y cerrar un cursor de servidor por cada conjunto de resultados usará más recursos del lado cliente y en el lado servidor de lo que sucede cuando <span sdata="langKeyword" value="selectMethod"><span class="keyword">selectMethod</span></span> no está configurado en <span sdata="langKeyword" value="cursor"><span class="keyword">cursor</span></span>.</p></li><li><p>Lea los valores grandes de texto o binarios como flujos mediante los métodos <b>getAsciiStream</b>, <b>getBinaryStream,</b> o <b>getCharacterStream</b> en lugar de los métodos <b>getBlob</b> o <b>getClob</b>. Desde la versión 1.2, la clase <a href="30710a63-c05d-47d9-9cf9-c087a1c76373.htm">SQLServerCallableStatement</a> proporciona métodos nuevos <b>get&lt;Type&gt;Stream</b> para este propósito.</p></li><li><p>Asegúrese de que las columnas con valores potencialmente grandes se colocan en último lugar en la lista de columnas en una instrucción SELECT y de que se usan los métodos <b>get&lt;Type&gt;Stream</b> de <a href="eaffcff1-286c-459f-83da-3150778480c9.htm">SQLServerResultSet</a> para tener acceso a las columnas en el orden en que se seleccionan.</p></li><li><p>Asegúrese de que los parámetros OUT con valores potencialmente grandes se declaran en último lugar en la lista de parámetros del código SQL que se usa para crea la <a href="30710a63-c05d-47d9-9cf9-c087a1c76373.htm">SQLServerCallableStatement</a>. Además, compruebe que se usan los métodos <b>get&lt;Type&gt;Stream</b> de <a href="30710a63-c05d-47d9-9cf9-c087a1c76373.htm">SQLServerCallableStatement</a> para tener acceso a los parámetros OUT en el orden en que se declaran.</p></li><li><p>Evite ejecutar simultáneamente más de una instrucción en la misma conexión. Ejecutar otra instrucción antes de procesar los resultados de la anterior puede provocar que los resultados sin procesar se almacenen en el búfer en la memoria de la aplicación.</p></li><li><p>Hay algunos casos en los que usar <span sdata="langKeyword" value="selectMethod=cursor"><span class="keyword">selectMethod=cursor</span></span> en lugar de <span sdata="langKeyword" value="responseBuffering=adaptive"><span class="keyword">responseBuffering=adaptive</span></span> sería más beneficioso, como por ejemplo:</p><ul><li><p>Si su aplicación procesa lentamente un conjunto de resultados de solo avance y solo lectura, como la lectura de cada fila después de alguna entrada del usuario, utilizar <span sdata="langKeyword" value="selectMethod=cursor"><span class="keyword">selectMethod=cursor</span></span> en lugar de<span sdata="langKeyword" value="responseBuffering=adaptive"><span class="keyword">responseBuffering=adaptive</span></span> puede ayudar a reducir el uso de recursos por SQL Server. </p></li><li><p>Si su aplicación procesa dos o más conjuntos de resultados de solo avance y solo lectura al mismo tiempo en la misma conexión, utilizar <span sdata="langKeyword" value="selectMethod=cursor"><span class="keyword">selectMethod=cursor</span></span> en lugar de <span sdata="langKeyword" value="responseBuffering=adaptive"><span class="keyword">responseBuffering=adaptive</span></span> podría ayudar a reducir la memoria necesaria para el controlador mientras procesa estos conjuntos de resultados.</p></li></ul><p>En ambos casos, necesita considerar la sobrecarga de crear, leer y cerrar los cursores de servidor.</p></li></ul><p>Además, la siguiente lista proporciona algunas recomendaciones para los conjuntos de resultados desplazables y actualizables de solo avance:</p><ul><li><p>Para los conjuntos de resultados desplazables, cuando recupera un conjunto de filas el controlador siempre lee en la memoria el número de filas indicado por el método <a href="7bc96930-b0c9-42f6-8df9-1d8d824408b3.htm">getFetchSize</a> del objeto <a href="eaffcff1-286c-459f-83da-3150778480c9.htm">SQLServerResultSet</a>, incluso aunque esté habilitado el almacenamiento en búfer adaptable. Si el desplazamiento produce un <b>OutOfMemoryError</b>, puede reducir el número de filas recuperadas llamando al método <a href="233bf4f8-4758-42d0-a80b-33e34fa78027.htm">setFetchSize</a> del objeto <a href="eaffcff1-286c-459f-83da-3150778480c9.htm">SQLServerResultSet</a> para configurar el tamaño de captura en un número de filas más pequeño, incluso una sola fila si es necesario. Si esto no impide un <b>OutOfMemoryError, </b>, evite incluir columnas muy grandes en los conjuntos de resultados desplazables.</p></li><li><p>Para los conjuntos de resultados de solo avance, cuando recupera un conjunto de filas el controlador normalmente lee en la memoria el número de filas indicado por el método <a href="7bc96930-b0c9-42f6-8df9-1d8d824408b3.htm">getFetchSize</a> del objeto <a href="eaffcff1-286c-459f-83da-3150778480c9.htm">SQLServerResultSet</a>, incluso aunque el almacenamiento en búfer adaptable esté habilitado en la conexión. Si la llamada al método <a href="60248447-6908-4036-a779-a501453cd553.htm">next</a> del objeto <a href="eaffcff1-286c-459f-83da-3150778480c9.htm">SQLServerResultSet</a> produce un <b>OutOfMemoryError</b>, puede reducir el número de filas recuperadas llamando al método <a href="233bf4f8-4758-42d0-a80b-33e34fa78027.htm">setFetchSize</a> del objeto <a href="eaffcff1-286c-459f-83da-3150778480c9.htm">SQLServerResultSet</a> para configurar el tamaño de captura en un número de filas más pequeño, incluso una sola fila si es necesario. También puede forzar el controlador para que no almacene filas en el almacenamiento den búfer llamando al método <a href="9f489835-6cda-4c8c-b139-079639a169cf.htm">setResponseBuffering</a> del objeto <a href="ec24963c-8b51-4838-91e9-1fbfa2347451.htm">SQLServerStatement</a> con el parámetro "<span sdata="langKeyword" value="adaptive"><span class="keyword">adaptive</span></span>" antes de ejecutar la instrucción. Como el conjunto de resultados no es desplazable, si la aplicación obtiene acceso a un número de columna grande utilizando uno de los métodos <b>get&lt;Type&gt;Stream</b>, el controlador rechaza el valor en cuanto la aplicación lo lee, lo mismo que hace con los conjuntos de resultados de solo avance y solo lectura.</p></li></ul></div><span id="seeAlsoSpan"><h1 class="heading">Vea también</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="e1592499-b87b-45ee-bab8-beaba8fde841.htm">Mejorar el rendimiento y la confiabilidad con el controlador JDBC</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">Enviar <a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','8.0.12060.10000','%0\dLe%20agradecemos%20sus%20comentarios.%20Los%20equipos%20de%20desarrolladores%20usan%20estos%20comentarios%20para%20mejorar%20la%20documentación.%20Mientras%20revisamos%20los%20comentarios,%20es%20posible%20que%20le%20enviemos%20un%20correo%20electrónico%20para%20solicitarle%20alguna%20aclaración%20o%20comentarios%20sobre%20una%20posible%20solución.%20No%20usamos%20su%20dirección%20de%20correo%20electrónico%20para%20ningún%20otro%20propósito%20y%20ésta%20se%20borra%20una%20vez%20finalizada%20la%20revisió.%0\APara%20obtener%20más%20información%20acerca%20de%20las%20directivas%20de%20privacidad%20de%20Microsoft,%20vea%20http://privacy.microsoft.com/es-es/default.aspx.%0\A%0\d','Comentarios%20del cliente');">comentarios de </a> acerca de este tema Microsoft.</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft. Todos los derechos reservados.</a></p></span></div></div></body></html>