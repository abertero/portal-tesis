<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>Usar la autenticación integrada de Kerberos para conectar con SQL Server</title><meta name="Language" content="es-es" /><meta name="Microsoft.Help.Id" content="687802dc-042a-4363-89aa-741685d165b3" /><meta name="Description" content="A partir del Controlador Microsoft JDBC 4.0 para SQL Server, una aplicación puede usar la propiedad de conexión authenticationScheme para indicar que desea conectar con una base de datos usando la autenticación integrada Kerberos de tipo 4." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">Usar la autenticación integrada de Kerberos para conectar con SQL Server</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>A partir del Controlador Microsoft JDBC 4.0 para SQL Server, una aplicación puede usar la propiedad de conexión <span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> para indicar que desea conectar con una base de datos usando la autenticación integrada Kerberos de tipo 4. Vea <span sdata="link"><a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">Establecer las propiedades de conexión</a></span> para obtener más información sobre las propiedades de conexión. Para obtener más información sobre Kerberos, vea <a href="http://go.microsoft.com/fwlink/?LinkId=101449">Complemento técnico de Kerberos para Windows</a> y <a href="http://go.microsoft.com/fwlink/?LinkID=100758">Microsoft Kerberos</a>.</p><p>Cuando se usa la autenticación integrada con el <span sdata="langKeyword" value="Krb5LoginModule"><span class="keyword">Krb5LoginModule</span></span> de Java, puede configurar el módulo mediante <a href="http://download.oracle.com/javase/1.5.0/docs/guide/security/jaas/spec/com/sun/security/auth/module/Krb5LoginModule.html">Class Krb5LoginModule</a>.</p><p>El Controlador Microsoft JDBC para SQL Server establece las propiedades siguientes para las máquinas virtuales Java de IBM:</p><ul><li><p><span sdata="langKeyword" value="useDefaultCcache = true"><span class="keyword">useDefaultCcache = true</span></span></p></li><li><p><span sdata="langKeyword" value="moduleBanner = false"><span class="keyword">moduleBanner = false</span></span></p></li></ul><p>El Controlador Microsoft JDBC para SQL Server establece las propiedades siguientes para todas las demás máquinas virtuales Java:</p><ul><li><p><span sdata="langKeyword" value="useTicketCache = true"><span class="keyword">useTicketCache = true</span></span></p></li><li><p><span sdata="langKeyword" value="doNotPrompt = true"><span class="keyword">doNotPrompt = true</span></span></p></li></ul></div><h1 class="heading">Notas</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>Antes del Controlador Microsoft JDBC 4.0 para SQL Server, las aplicaciones podían especificar la autenticación integrada (usando Kerberos o NTLM, dependiendo de lo que hubiera disponible) mediante la propiedad de conexión <span sdata="langKeyword" value="integratedSecurity"><span class="keyword">integratedSecurity</span></span> y por referencia a <span sdata="langKeyword" value="sqljdbc_auth.dll"><span class="keyword">sqljdbc_auth.dll</span></span>, como se describe en <span sdata="link"><a href="44996746-d373-4f59-9863-a8a20bb8024a.htm">Generar URL de conexión</a></span>.</p><p>A partir del Controlador Microsoft JDBC 4.0 para SQL Server, una aplicación puede usar la propiedad de conexión <span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> para indicar que desea conectar con una base de datos usando la autenticación integrada Kerberos con la implementación Kerberos pura de Java:</p><ul><li><p>Si desea usar la autenticación integrada mediante <span sdata="langKeyword" value="Krb5LoginModule"><span class="keyword">Krb5LoginModule</span></span>, debe seguir especificando la propiedad de conexión <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span>. Entonces, también tiene que especificar la propiedad de conexión <span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span>.</p></li><li><p>Para seguir usando la autenticación integrada con <span sdata="langKeyword" value="sqljdbc_auth.dll"><span class="keyword">sqljdbc_auth.dll</span></span>, basta con especificar la propiedad de conexión <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span> (y opcionalmente <span sdata="langKeyword" value="authenticationScheme=NativeAuthentication"><span class="keyword">authenticationScheme=NativeAuthentication</span></span>).</p></li><li><p>Si especifica <span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span> pero no <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span>, el controlador omitirá la propiedad de conexión <span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> y esperará hasta que encuentre las credenciales de nombre de usuario y contraseña en la cadena de conexión.</p></li></ul><p>Cuando se usa un origen de datos para crear conexiones, se puede establecer mediante programación el esquema de autenticación mediante <a href="b942f78e-7ce1-44ef-923d-a7c3d7c76b83.htm">setAuthenticationScheme</a>.</p><p>Se ha agregado un nuevo registrador para admitir la autenticación Kerberos: com.microsoft.sqlserver.jdbc.internals.KerbAuthentication. Para obtener más información, vea <span sdata="link"><a href="723aeae7-6504-4585-ba8b-3525115bea8b.htm">Hacer un seguimiento del funcionamiento del controlador</a></span>.</p><p>Las directrices siguientes le ayudarán a configurar Kerberos:</p><ol><li><p>Establezca <span sdata="langKeyword" value="AllowTgtSessionKey"><span class="keyword">AllowTgtSessionKey</span></span> en 1 en el Registro de Windows. Para obtener más información, vea <a href="http://support.microsoft.com/kb/837361">Entradas del Registro del protocolo Kerberos y claves de configuración del KDC en Windows Server 2003</a>.</p></li><li><p>Asegúrese de que la configuración de Kerberos (krb5.conf en entornos UNIX) apunta al dominio Kerberos y al KDC correctos para su entorno.</p></li><li><p>Inicialice la memoria caché del TGT mediante kinit o iniciando sesión en el dominio.</p></li><li><p>Cuando una aplicación que usa <span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span> se ejecuta en los sistemas operativos Windows Vista o Windows 7, debe emplear una cuenta de usuario estándar. Sin embargo, si ejecuta la aplicación en una cuenta de administrador, la aplicación debe ejecutarse con privilegios de administrador.</p></li></ol></div><h1 class="heading">Nombres de entidad de seguridad de servicio</h1><div id="sectionSection1" class="section" name="collapseableSection" style=""><p>Un nombre de entidad de seguridad de servicio (SPN) es el nombre por el cual un cliente identifica de manera única una instancia de un servicio. Para obtener más información sobre los nombres de entidad de seguridad de servicio (SPN), vea:</p><ul><li><p><a href="http://support.microsoft.com/kb/319723">Cómo utilizar la autenticación Kerberos en SQL Server</a></p></li><li><p><a href="http://go.microsoft.com/fwlink/?LinkId=207814">Usar Kerberos con SQL Server</a></p></li></ul></div><h1 class="heading">Crear un archivo de configuración de un módulo de inicio de sesión</h1><div id="sectionSection2" class="section" name="collapseableSection" style=""><p>Si lo desea, puede especificar un archivo de configuración de Kerberos. Si no se especifica ningún archivo de configuración, se usarán las configuraciones siguientes:</p><dl class="authored"><dt>Máquina virtual Java de Sun</dt><dd><p>com.sun.security.auth.module.Krb5LoginModule required useTicketCache=true doNotPrompt=true;</p></dd><dt>Máquina virtual Java de IBM</dt><dd><p>com.ibm.security.auth.module.Krb5LoginModule required useDefaultCcache = true moduleBanner = false;</p></dd></dl><p>Si decide crear un archivo de configuración de un módulo de inicio de sesión, el archivo debe seguir este formato:</p><div class="sampleCode"><span codeLanguage="other"><pre>&lt;<i>name</i>&gt; {
    &lt;<i>LoginModule</i>&gt; &lt;<i>flag</i>&gt; &lt;<i>LoginModule options</i>&gt;;
    &lt;<i>optional_additional_LoginModules</i>, <i>flags_and_options</i>&gt;;
};</pre></span></div><p>Un archivo de configuración de inicio de sesión consta de una o varias entradas, cada una de las cuales especifica qué tecnología de autenticación subyacente se debe usar para una o varias aplicaciones determinadas. Por ejemplo,</p><div class="sampleCode"><span codeLanguage="other"><pre>SQLJDBCDriver {
   com.sun.security.auth.module.Krb5LoginModule required useTicketCache=true doNotPrompt=true;
};</pre></span></div><p>Cada entrada de un archivo de configuración de un módulo de inicio de sesión consta de un nombre seguido de una o varias entradas específicas del módulo, donde cada una de estas entradas termina con un signo de punto y coma y todo el grupo de entradas específicas del módulo está entre llaves. Cada entrada del archivo de configuración termina con un signo de punto y coma.</p><p>Además de permitir al controlador adquirir credenciales de Kerberos usando las configuraciones especificadas en el archivo de configuración del módulo de inicio de sesión, el controlador puede emplear credenciales existentes. Esto puede resultar útil cuando la aplicación necesite crear conexiones usando credenciales de más de un usuario.</p><p>El controlador intentará usar credenciales existentes si están disponibles, antes de intentar el inicio de sesión usando el módulo de inicio de sesión especificado. Así, cuando se usa el método Subject.doAs para ejecutar código bajo un contexto determinado, se creará una conexión con las credenciales pasadas a la llama a Subject.doAs.</p><p>Para obtener más información, vea <a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jaas/tutorials/LoginConfigFile.html">Archivo de configuración de inicio de sesión JAAS</a> y <a href="http://download.oracle.com/javase/1.5.0/docs/guide/security/jgss/tutorials/KerberosReq.html">Clase Krb5LoginModule</a>.</p></div><h1 class="heading">Crear un archivo de configuración de Kerberos</h1><div id="sectionSection3" class="section" name="collapseableSection" style=""><p>Para obtener más información sobre los archivos de configuración de Kerberos, vea <a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jaas/tutorials/LoginConfigFile.html">Requisitos de Kerberos</a>.</p><p>A continuación se muestra un archivo de configuración de dominio de ejemplo, donde YYYY e ZZZZ son nombres de dominio de su sitio.</p><div class="sampleCode"><span codeLanguage="other"><pre>[libdefaults]
default_realm = YYYY.CORP.CONTOSO.COM
dns_lookup_realm = false
dns_lookup_kdc = true
ticket_lifetime = 24h
forwardable = yes

[domain_realm]
.yyyy.corp.contoso.com = YYYY.CORP.CONTOSO.COM
.zzzz.corp.contoso.com = ZZZZ.CORP.CONTOSO.COM

[realms]
        YYYY.CORP.CONTOSO.COM = {
  kdc = krbtgt/YYYY.CORP. CONTOSO.COM @ YYYY.CORP. CONTOSO.COM
  default_domain = YYYY.CORP. CONTOSO.COM
}

        ZZZZ.CORP. CONTOSO.COM = {
  kdc = krbtgt/ZZZZ.CORP. CONTOSO.COM @ ZZZZ.CORP. CONTOSO.COM
  default_domain = ZZZZ.CORP. CONTOSO.COM
}
</pre></span></div></div><h1 class="heading">Habilitar el archivo de configuración de dominio y el archivo de configuración del módulo de inicio de sesión</h1><div id="sectionSection4" class="section" name="collapseableSection" style=""><p>Puede habilitar un archivo de configuración de dominio con -Djava.security.krb5.conf. Puede habilitar un archivo de configuración de módulo de inicio de sesión con <span sdata="langKeyword" value="-Djava.security.auth.login.config"><span class="keyword">-Djava.security.auth.login.config</span></span>.</p><p>Por ejemplo, al iniciar la aplicación podría usar esta línea de comandos:</p><div class="sampleCode"><span codeLanguage="other"><pre>Java.exe -Djava.security.auth.login.config=SQLJDBCDriver.conf -Djava.security.krb5.conf=krb5.ini &lt;<i>APPLICATION_NAME</i>&gt;
</pre></span></div></div><h1 class="heading">Comprobar que se puede obtener acceso a SQL Server mediante Kerberos</h1><div id="sectionSection5" class="section" name="collapseableSection" style=""><p>Ejecute la consulta siguiente en SQL Server Management Studio:</p><p><span sdata="langKeyword" value="select auth_scheme from sys.dm_exec_connections where session_id=@@spid"><span class="keyword">select auth_scheme from sys.dm_exec_connections where session_id=@@spid</span></span></p><p>Asegúrese de que tiene el permiso necesario para ejecutar esta consulta.</p></div><span id="seeAlsoSpan"><h1 class="heading">Vea también</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="94bcfbe3-f00e-4774-bda8-bb7577518fec.htm">Conectar SQL Server con el controlador JDBC</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">Enviar <a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','8.0.12060.10000','%0\dLe%20agradecemos%20sus%20comentarios.%20Los%20equipos%20de%20desarrolladores%20usan%20estos%20comentarios%20para%20mejorar%20la%20documentación.%20Mientras%20revisamos%20los%20comentarios,%20es%20posible%20que%20le%20enviemos%20un%20correo%20electrónico%20para%20solicitarle%20alguna%20aclaración%20o%20comentarios%20sobre%20una%20posible%20solución.%20No%20usamos%20su%20dirección%20de%20correo%20electrónico%20para%20ningún%20otro%20propósito%20y%20ésta%20se%20borra%20una%20vez%20finalizada%20la%20revisió.%0\APara%20obtener%20más%20información%20acerca%20de%20las%20directivas%20de%20privacidad%20de%20Microsoft,%20vea%20http://privacy.microsoft.com/es-es/default.aspx.%0\A%0\d','Comentarios%20del cliente');">comentarios de </a> acerca de este tema Microsoft.</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft. Todos los derechos reservados.</a></p></span></div></div></body></html>